<div class="team-display-container">
  <!-- Header -->
  <div class="header">
    <h2 class="title">FPL Team Viewer</h2>
    <p class="subtitle">View any FPL team by entering their unique team ID</p>
  </div>

  <!-- Input Section -->
  <div class="input-section">
    <div class="input-group">
      <label for="teamId" class="label">Team ID:</label>
      <input
        type="number"
        id="teamId"
        [(ngModel)]="teamId"
        (keypress)="onKeyPress($event)"
        placeholder="e.g., 123456"
        class="input"
        [disabled]="isLoading"
        min="1"
      />
    </div>

    <div class="checkbox-group">
      <input
        type="checkbox"
        id="includePicks"
        [(ngModel)]="includePicks"
        class="checkbox"
        [disabled]="isLoading"
      />
      <label for="includePicks" class="checkbox-label">Include current team picks</label>
    </div>

    <div class="button-group">
      <button
        (click)="loadTeam()"
        [disabled]="isLoading || !teamId"
        class="btn btn-primary"
      >
        <span *ngIf="!isLoading">Load Team</span>
        <span *ngIf="isLoading">Loading...</span>
      </button>

      <button
        *ngIf="team"
        (click)="clearTeam()"
        [disabled]="isLoading"
        class="btn btn-secondary"
      >
        Clear
      </button>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message" data-error>
    <div class="error-content">
      <span class="error-icon">‚ö†Ô∏è</span>
      <span>{{ error }}</span>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-spinner">
    <div class="spinner"></div>
    <p>Loading team data...</p>
  </div>

  <!-- Team Data -->
  <div *ngIf="team && !isLoading" class="team-data" data-team>
    <!-- Team Header -->
    <div class="team-header">
      <h3 class="team-name">{{ team.name }}</h3>
      <p class="manager-name">Manager: {{ managerName }}</p>
    </div>

    <!-- Team Statistics -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Overall Points</div>
        <div class="stat-value">{{ formatNumber(team.summary_overall_points) }}</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Overall Rank</div>
        <div class="stat-value">{{ formatNumber(team.summary_overall_rank) }}</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Gameweek Points</div>
        <div class="stat-value">{{ team.summary_event_points }}</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Gameweek Rank</div>
        <div class="stat-value">{{ formatNumber(team.summary_event_rank) }}</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Team Value</div>
        <div class="stat-value">¬£{{ teamValueInMillions.toFixed(1) }}m</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">In Bank</div>
        <div class="stat-value">¬£{{ bankInMillions.toFixed(1) }}m</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Current Gameweek</div>
        <div class="stat-value">GW {{ currentGameweek }}</div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Free Transfers Available</div>
        <div class="stat-value">{{ freeTransfersAvailable }}</div>
      </div>
    </div>

    <!-- Team Picks -->
    <div *ngIf="team.picks && team.picks.length > 0" class="team-picks">
      <h4 class="section-title">Current Team Selection</h4>

      <!-- Starting XI -->
      <div class="starting-eleven">
        <div class="formation-pitch">
          <!-- Forwards -->
          <div class="formation-row forwards">
            <div
              *ngFor="let pick of forwards; trackBy: trackByPosition"
              class="player-card"
            >
              <span *ngIf="pick.is_captain" class="player-captain-badge"></span>
              <span *ngIf="pick.is_vice_captain" class="player-vice-badge"></span>
              <div class="player-shirt">
                <img
                  [src]="getPlayerShirtUrl(pick)"
                  [alt]="pick.player_name"
                  class="shirt-image"
                />
                <div class="shirt-price">¬£{{ (getPlayerCostValue(pick) / 10).toFixed(1) }}</div>
              </div>
              <div class="player-info">
                <div class="player-name">{{ pick.player_name || 'Player ' + pick.element }}</div>
                <div class="player-details">
                  <span class="player-team">{{ getTeamShortName(pick) }} ({{ getFixtureDisplay(pick) }})</span>
                  <span class="player-xp">{{ formatExpectedPoints(pick) }}xP</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Midfielders -->
          <div class="formation-row midfielders">
            <div
              *ngFor="let pick of midfielders; trackBy: trackByPosition"
              class="player-card"
            >
              <span *ngIf="pick.is_captain" class="player-captain-badge"></span>
              <span *ngIf="pick.is_vice_captain" class="player-vice-badge"></span>
              <div class="player-shirt">
                <img
                  [src]="getPlayerShirtUrl(pick)"
                  [alt]="pick.player_name"
                  class="shirt-image"
                />
                <div class="shirt-price">¬£{{ (getPlayerCostValue(pick) / 10).toFixed(1) }}</div>
              </div>
              <div class="player-info">
                <div class="player-name">{{ pick.player_name || 'Player ' + pick.element }}</div>
                <div class="player-details">
                  <span class="player-team">{{ getTeamShortName(pick) }} ({{ getFixtureDisplay(pick) }})</span>
                  <span class="player-xp">{{ formatExpectedPoints(pick) }}xP</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Defenders -->
          <div class="formation-row defenders">
            <div
              *ngFor="let pick of defenders; trackBy: trackByPosition"
              class="player-card"
            >
              <span *ngIf="pick.is_captain" class="player-captain-badge"></span>
              <span *ngIf="pick.is_vice_captain" class="player-vice-badge"></span>
              <div class="player-shirt">
                <img
                  [src]="getPlayerShirtUrl(pick)"
                  [alt]="pick.player_name"
                  class="shirt-image"
                />
                <div class="shirt-price">¬£{{ (getPlayerCostValue(pick) / 10).toFixed(1) }}</div>
              </div>
              <div class="player-info">
                <div class="player-name">{{ pick.player_name || 'Player ' + pick.element }}</div>
                <div class="player-details">
                  <span class="player-team">{{ getTeamShortName(pick) }} ({{ getFixtureDisplay(pick) }})</span>
                  <span class="player-xp">{{ formatExpectedPoints(pick) }}xP</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Goalkeeper -->
          <div class="formation-row goalkeeper">
            <div
              *ngFor="let pick of goalkeepers; trackBy: trackByPosition"
              class="player-card"
            >
              <span *ngIf="pick.is_captain" class="player-captain-badge"></span>
              <span *ngIf="pick.is_vice_captain" class="player-vice-badge"></span>
              <div class="player-shirt">
                <img
                  [src]="getPlayerShirtUrl(pick)"
                  [alt]="pick.player_name"
                  class="shirt-image"
                />
                <div class="shirt-price">¬£{{ (getPlayerCostValue(pick) / 10).toFixed(1) }}</div>
              </div>
              <div class="player-info">
                <div class="player-name">{{ pick.player_name || 'Player ' + pick.element }}</div>
                <div class="player-details">
                  <span class="player-team">{{ getTeamShortName(pick) }} ({{ getFixtureDisplay(pick) }})</span>
                  <span class="player-xp">{{ formatExpectedPoints(pick) }}xP</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Substitutes -->
      <div class="substitutes" *ngIf="substitutes.length > 0">
        <div class="bench">
          <div
            *ngFor="let pick of substitutes; trackBy: trackByPosition"
            class="player-card bench-card"
          >
            <span *ngIf="!isSubstituteGoalkeeper(pick)" class="bench-number">{{ getBenchNumber(pick) }}</span>
            <span class="bench-label">{{ getPositionAbbreviation(pick) }}</span>
            <div class="player-shirt">
              <img
                [src]="getPlayerShirtUrl(pick)"
                [alt]="pick.player_name"
                class="shirt-image"
              />
              <div class="shirt-price">¬£{{ (getPlayerCostValue(pick) / 10).toFixed(1) }}</div>
            </div>
            <div class="player-info">
              <div class="player-name">{{ pick.player_name || 'Player ' + pick.element }}</div>
              <div class="player-details">
                <span class="player-team">{{ getTeamShortName(pick) }} ({{ getFixtureDisplay(pick) }})</span>
                <span class="player-xp">{{ formatExpectedPoints(pick) }}xP</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Transfer Optimizer -->
    <app-transfer-optimizer [teamId]="team.id"></app-transfer-optimizer>
  </div>

  <!-- Help Text -->
  <div class="help-text" *ngIf="!team && !isLoading && !error">
    <p>üí° <strong>Tip:</strong> You can find your team ID in the FPL website URL when viewing your team.</p>
    <p>Example: https://fantasy.premierleague.com/entry/<strong>123456</strong>/event/1</p>
  </div>
</div>